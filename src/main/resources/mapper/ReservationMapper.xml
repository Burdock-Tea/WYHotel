<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ictproject.wyhotel.reservation.mapper.IReservationMapper">

	<sql id="locals">
		<choose>
			<when test="hotelCode == '10'">
				dining_seoul
			</when>
			<when test="hotelCode == '20'">
				dining_busan
			</when>
			<otherwise>
				dining_jeju
			</otherwise>
		</choose>
	</sql>
	<select id="getRoomList" resultType="room">
		<![CDATA[
		SELECT tbl.* FROM
		(SELECT r.*, hr.room_count, 
        hr.room_count - (SELECT COUNT(*) FROM room_reservation rr
        WHERE  rr.hotel_code = hr.hotel_code AND rr.room_code = hr.room_code
        AND rr.check_in_date <= #{checkInDate} AND rr.check_out_date >= #{checkOutDate}) AS remain_room_cnt
        FROM hotel_rooms hr LEFT JOIN rooms r ON hr.room_code = r.room_code
		WHERE hr.hotel_code = #{hotelCode}) tbl
		WHERE remain_room_cnt > 0
		]]>
	</select>
	
	<select id="getDiningList" resultType="dining">
		SELECT * FROM
		<include refid="locals" />
	</select>

</mapper>